#### Overview

The `Vault` contracts, comprising `NativeVault` and `TokenVault`, are integral components of the `Optimex Protocol`, providing secure custody and management of assets for trades conducted across multiple asset chains. These contracts enable the deposit of assets, settlement of trades through validated multi-signature processes, and refunding of unclaimed funds after a specified timeout. They ensure seamless functionality for both native coins and tokens, with clear separation of handling among locking tokens.

#### Key Components and Descriptions

1.  Access Control:
    - The contract uses `EIP-712` standard for domain separation in hashing and signing messages, allowing secure signature verification.
    - Utilizes `EIP-712` signatures to authenticate trade settlements.
2.  Signatures and Hashes:
    - `_PRESIGN`: The keccak256 hash used for presigning trade information, ensuring integrity in trade details.
    - `_SETTLEMENT`: The keccak256 hash representing settlement data, ensuring the accuracy of total fee and presign information.
3.  Settlement and Refund
    - Finalizes trades by securely transferring locked funds to the designated receiver (`toAddress`), subject to multi-signature validation.
    - Returns locked funds to the depositor (`refundAddress`) if the trade remains unsettled past the `timeout`, safeguarding user assets.
4.  Per-Asset Management:
    - Each `Vault` (`NativeVault` or `TokenVault`) manages a single type of coin or token across multiple trades.
    - The logic for settlements and claims is isolated for each type of coin or token, ensuring clear separation and precise handling of assets.

#### Functions Documentation

1.  `function deposit(address ephemeralL2Address, TradeInput input, TradeDetail detail)`

    - Purpose: Deposits the specified `amount` to initialize a `tradeId` and lock the funds.
    - Parameters:
      - `ephemeralL2Address`:
        - Description: An address derived from the `ephemeralL2Key`, used to authorize updates within the `Optimex Protocol`.
        - Type: `uint256`
      - `input`:
        - Description: The data object containing trade-related information:
          - `amountIn`: The amount specified for the trade.
          - `fromChain`: An array of data that includes:: `fromUserAddress`, `fromNetworkId`, and `fromTokenId`.
          - `toChain`: An array of data that includes: `toUserAddress`, `toNetworkId`, and `toTokenId`
        - Type: `TradeInput`
      - `detail`:
        - Description: A data object containing details for finalization on the asset chain:
          - `amount`: The amount being deposited. This must match `amountIn`.
          - `timeout`: The timestamp after which locked funds become refundable.
          - `mpc`: An address derived from the threshold keys of the `MPC`.
          - `ephemeralAssetAddress`: An address derived from `ephemeralAssetKey`.
          - `refundAddress`: The recipient address for claiming refunds after `timeout`.
        - Type: `TradeDetail`
    - Requirements:
      - Can be called by `ANY`.
      - A valid `TradeInput` object to generate the `tradeId`.
      - The `msg.sender` must match the address specified in the `TradeInput`.
      - A valid `TradeDetail` object.
    - Events: Emits `Deposited` event.
    - Note: There are two versions of this function:
      - `NativeVault`: Accepts only native coins for deposits.
      - `TokenVault`: Accepts only the token specified in `LOCKING_TOKEN` for deposits.

2.  `function settlement(bytes32 tradeId, uint256 totalFee, address toAddress, TradeDetail detail, bytes presign, bytes mpcSignature)`

    - Purpose: Transfers the specified `amount` to `toAddress`, finalizing the trade identified by `tradeId`.
    - Parameters:
      - `tradeId`:
        - Description: A unique identifier for the trade.
        - Type: `bytes32`
      - `totalFee`:
        - Description: The total fee to be transferred to `pFeeAddr`.
        - Type: `uint256`
      - `toAddress`:
        - Description: The recipient address for the trade settlement.
        - Type: `address`
      - `detail`:
        - Description: A data object containing the following trade details for finalization on the asset chain: `amount`, `timeout`, `mpc`, `ephemeralAssetAddress`, and `refundAddress`.
        - Type: `TradeDetail`
      - `presign`:
        - Description: A presignature created by `ephemeralAssetKey`, confirming user consent.
        - Type: `bytes`
      - `mpcSignature`:
        - Description: A signature generated by threshold `MPC` keys, verifying the legitimacy of the settlement.
        - Type: `bytes`
    - Requirements:
      - Caller can be `ANY`.
      - Both `presign` and `mpcSignature` must be valid.
      - The function can only be called if the current timestamp is less than or equal to `timeout`.
      - The `toAddress` must match the recipient specified in the `presign`.
      - The hash of the `TradeDetail` object must match the value recorded during the deposit stage.
    - Events: Emits `Settled` event.

3.  `function claim(bytes32 tradeId, TradeDetail detail)`

    - Purpose: Refunds locked funds to the depositor after the `timeout` has elapsed.
    - Parameters:
      - `tradeId`:
        - Description: A unique identifier for the trade.
        - Type: `bytes32`
      - `detail`:
        - Description: A data object containing the following trade details for finalization on the asset chain: `amount`, `timeout`, `mpc`, `ephemeralAssetAddress`, and `refundAddress`.
        - Type: `TradeDetail`
    - Requirements:
      - Can be called by `ANY`.
      - The call is valid only after the specified `timeout` has passed.
      - The hash of the `TradeDetail` object must match the value recorded during the deposit stage.
    - Events: Emits `Claimed` event.
